<app-titlebar
  [title]="'Página Inicial'"
></app-titlebar>

  <div class="container-fluid mt-0 ms-0 pt-0 ps-0">
    <p>Filtros</p>
  </div>


  <div class="table-responsive">
    <tr>
      <td>
        <input type="date" [(ngModel)]="dataInicio" class="form-control" placeholder="Data de início" style="width: 145px;">
      </td>
      <td>
        <input type="date" [(ngModel)]="dataFim" class="form-control" placeholder="Data final" style="width: 145px;">
      </td>
      <td class="dropdown-container">
        <div (click)="toggleUserDropdown()" class="dropdown-toggle" style="background-color: blue; height: 40px; width: 100px; padding:7px; color: white; border-radius: 8px; margin-bottom: 10px;">
          Usuários 
        </div>
        <div *ngIf="showUserDropdown" class="dropdown">
          <div *ngFor="let usuario of usuarios">
            <label>
              <input type="checkbox" [(ngModel)]="selectedUsers[usuario.userName]" (change)="onUserOptionChange()">
              {{ usuario.userName }}
            </label>
          </div>
        </div>
      </td>
      <button (click)="getEmprestimosFiltrados(dataInicio, dataFim, selectedUsers)">Aplicar filtros</button>
    </tr>
      <div style="min-height: 500px;">
          <table class="table table-striped table-hover table-light rounded-3 ">
              <thead class="table-primary">
                  <tr>
                      <th class="d-none d-md-table-cell d-flex justify-center">
                          <a class="text-white" (click)="alterarImagem()">
                              <mat-icon>{{exibirImagem ? 'visibility' : 'visibility_on'}}</mat-icon>
                            </a>
                          </th>
                          <th>#</th>
                          <th>ISBN</th>
                          <th>Título</th>
                          <th>Data da solicitação</th>
                          <th>Local de entrega</th>
                          <th>Local de coleta</th>
                          <th>Data prevista de devolução</th>
                          <th>Data de devolução</th>
                          <th>Usuário</th>
                          <th>Situação</th>
                      </tr>
                  </thead>
              <tbody>
                <tbody>
                  <tr *ngFor="let emprestimo of emprestimos; let i=index;">
                    <td>
                      <img [(ngbCollapse)]="!exibirImagem" src={{emprestimo.acervo.capaUrl}} alt="Capa do livro" [style.width.px]="50" [style.margin.px]="2">
                    </td>
                    <td>{{i+1}}</td>
                      <td>{{emprestimo.acervo.isbn}}</td>
                      <td>{{emprestimo.acervo.titulo}}</td>
                      <td>{{formatarData(emprestimo.dataEmprestimo)}}</td>
                      <td>{{emprestimo.localDeEntrega}}</td>
                      <td>{{emprestimo.localDeColeta}}</td>
                      <td>{{formatarData(emprestimo.dataPrevistaDevolucao)}}</td>
                      <td>{{formatarData(emprestimo.dataDevolucao)}}</td>
                      <td>{{emprestimo.userName}}</td>
                      <td>{{obterStatus(emprestimo)}}</td>
                  </tr>
                </tbody>
            <tfoot>
              <td *ngIf="!emprestimos.length" colspan="12" class="text-center">
                <h6>Não foram encontrados resultados para a pesquisa</h6>
            </td>
            </tfoot>
        </table>
    </div>
</div>

<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="square-jelly-box">
    <p style="font-size: 20px; color: white">Carregando...</p>
</ngx-spinner>
